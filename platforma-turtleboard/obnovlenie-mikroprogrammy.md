---
description: >-
  Перед началом обновления внимательно прочтите эту страницу до конца и
  убедитесь, что понимаете все описанные операции.
---

# Обновление микропрограммы

Для обновления микропрограммы системной платы TurtleBro необходимо использовать USB-UART переходник и программу [STM32 Flash loader demonstrator](https://yadi.sk/d/lfNmZ8NGI7_0UQ). Актуальные прошивки лежат в [нашем репозитории](https://yadi.sk/d/xjULj9a88wCkdA). Придерживайтесь следующей инструкции:

* Выключите питание робота и извлеките из него батарею. 
* Подсоедините USB-UART переходник к разъему ST-UPDT голубого цвета на системной плате. Обратите внимание на то, что ножка TX переходника должна быть соединена с ножкой RX разъема ST-UPDT, а ножка RX - к TX. 

{% hint style="danger" %}
Ножка 3V3 разъема ST-UPDT может быть подключена только к источнику напряжения 3.3В! Подключение ее к 5В может привести к повреждению платы!
{% endhint %}

* Переведите DIP-переключатель №4 в положение "ON"
* Подключите USB-UART к компьютеру, он должен определиться системой как COM порт.
* Нажмите кнопку HW\_RESET на плате, это должно привести к тому, что все светодиоды погаснут и плата перейдет в режим ожидания прошивки.
* Запустите программу STM32 Flash loader demonstrator, выберите COM порт своего UART преобразователя. Нажмите кнопку Next.

![](../.gitbook/assets/1.png)

Вы должны увидеть сообщение:

```
Target is readable. Please click "Next" to proceed
```

{% hint style="warning" %}
Если этого не произошло, проверьте правильность выполнения предыдущих шагов и попробуйте еще раз
{% endhint %}

В следующем окне вы должны увидеть приблизительно следующее: 

![](../.gitbook/assets/3_1.png)

Обратите внимание на поле Target: его содержимое должно точно совпадает с картинкой выше. 

В следующем окне необходимо выставить настройки точно так же, как на картинке внизу:

![](../.gitbook/assets/5.png)

{% hint style="info" %}
В графе Download from file необходимо указать на [файл прошивки](https://yadi.sk/d/eov3wiMFHE8zFw), скачанный с нашего сайта. Обратите внимание на то, что по умолчанию всплывающее окно не отображает необходимые нам файлы с расширением .hex, поэтому в правом нижнем углу окошка необходимо выбрать тип файла hex Files \(\*.hex\)
{% endhint %}

После нажатия кнопки Next должен начаться процесс обновления микропрограммы. Он может занять несколько минут, пожалуйста, дождитесь его окончания. После окончания загрузки вы должны увидеть сообщение:

```text
Download operation finished succesfully
```

* Закройте программу
* отключите UART переходник от компьютера
* отсоедините плату TurtleBro
* переведите DIP-переключатель №4 в положение Off

{% hint style="success" %}
При следующей запуске робот будет использовать обновленную микропрограмму
{% endhint %}

